<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ElasticSearchçš„åŸºæœ¬åº”ç”¨ | æµ®ç™½æ— åº¦</title>
<link rel="shortcut icon" href="https://fubaiwudu.github.io/favicon.ico?v=1585744365178">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fubaiwudu.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="ElasticSearchçš„åŸºæœ¬åº”ç”¨ | æµ®ç™½æ— åº¦ - Atom Feed" href="https://fubaiwudu.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="ğŸ˜€æœ‰é—®é¢˜çš„åœ°æ–¹å¸Œæœ›å¤§å®¶èƒ½å¸®æˆ‘æŒ‡å‡ºæ¥ï¼Œå¤§å®¶å…±åŒè¿›æ­¥ã€‚ğŸ˜„
Elasticsearchæ˜¯ä¸€ä¸ªå®æ—¶åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“
å®ƒç”¨äºå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æ
Elasticsearchçš„é©å‘½æ€§åœ¨äºå°†è¿™äº›ç‹¬ç«‹ä¸”æœ‰ç”¨çš„æŠ€æœ¯æ•´åˆæˆä¸€ä¸ªä¸€ä½“åŒ–çš„ã€å®æ—¶çš„åº”ç”¨..." />
    <meta name="keywords" content="ElasticSearch" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://fubaiwudu.github.io">
  <img class="avatar" src="https://fubaiwudu.github.io/images/avatar.png?v=1585744365178" alt="">
  </a>
  <h1 class="site-title">
    æµ®ç™½æ— åº¦
  </h1>
  <p class="site-description">
    
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              ElasticSearchçš„åŸºæœ¬åº”ç”¨
            </h2>
            <div class="post-info">
              <span>
                2020-04-01
              </span>
              <span>
                10 min read
              </span>
              
                <a href="https://fubaiwudu.github.io/tag/-QeVTGiWZ/" class="post-tag">
                  # ElasticSearch
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>ğŸ˜€æœ‰é—®é¢˜çš„åœ°æ–¹å¸Œæœ›å¤§å®¶èƒ½å¸®æˆ‘æŒ‡å‡ºæ¥ï¼Œå¤§å®¶å…±åŒè¿›æ­¥ã€‚ğŸ˜„</p>
<p>Elasticsearchæ˜¯ä¸€ä¸ªå®æ—¶åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“<br>
å®ƒç”¨äºå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æ<br>
Elasticsearchçš„é©å‘½æ€§åœ¨äºå°†è¿™äº›ç‹¬ç«‹ä¸”æœ‰ç”¨çš„æŠ€æœ¯æ•´åˆæˆä¸€ä¸ªä¸€ä½“åŒ–çš„ã€å®æ—¶çš„åº”ç”¨ã€‚<br>
Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºApache Lucene(TM) çš„å¼€æºæœç´¢å¼•æ“ï¼ŒLuceneåªæ˜¯ä¸€ä¸ªåº“ã€‚æƒ³è¦ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨Javaæ¥ä½œä¸ºå¼€å‘è¯­è¨€å¹¶å°†å…¶ç›´æ¥é›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­</p>
<p>Elasticsearchä¸ä»…ä»…æ˜¯Luceneå’Œå…¨æ–‡æœç´¢<br>
åˆ†å¸ƒå¼çš„å®æ—¶åˆ†ææœç´¢å¼•æ“<br>
å¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®<br>
å¯ä»¥é€šè¿‡ç®€å•çš„ RESTful API ã€å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ç”šè‡³å‘½ä»¤è¡Œä¸ä¹‹äº¤äº’ã€‚</p>
<p>å°æ•…äº‹ï¼š Shay Banonä¸ºäº†ç»™å¦»å­æ„å»ºä¸€ä¸ªé£Ÿè°±æœç´¢å¼•æ“ä»è€Œåˆ›å»ºäº†elastic</p>
<p>Java API<br>
Elasticsearchä¸ºJavaç”¨æˆ·æä¾›äº†ä¸¤ç§å†…ç½®å®¢æˆ·ç«¯ï¼š<br>
èŠ‚ç‚¹å®¢æˆ·ç«¯(node client) ï¼š<br>
èŠ‚ç‚¹å®¢æˆ·ç«¯ä»¥æ— æ•°æ®èŠ‚ç‚¹(none data node)èº«ä»½åŠ å…¥é›†ç¾¤ï¼Œå®ƒè‡ªå·±ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å®ƒçŸ¥é“æ•°æ®åœ¨é›†ç¾¤ä¸­        çš„å…·ä½“ä½ç½®ï¼Œå¹¶ä¸”èƒ½å¤Ÿç›´æ¥è½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šã€‚</p>
<pre><code>ä¼ è¾“å®¢æˆ·ç«¯(Transport client) ï¼š
    è¿™ä¸ªæ›´è½»é‡çš„ä¼ è¾“å®¢æˆ·ç«¯èƒ½å¤Ÿå‘é€è¯·æ±‚åˆ°è¿œç¨‹é›†ç¾¤ã€‚å®ƒè‡ªå·±ä¸åŠ å…¥é›†ç¾¤ï¼Œåªæ˜¯ç®€å•è½¬å‘è¯·æ±‚ç»™é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚
    ä¸¤ä¸ªJavaå®¢æˆ·ç«¯éƒ½é€šè¿‡9300ç«¯å£ä¸é›†ç¾¤äº¤äº’ï¼Œä½¿ç”¨Elasticsearchä¼ è¾“åè®®(Elasticsearch Transport Protocol)ã€‚èŠ‚ç‚¹ä¹Ÿé€šè¿‡9300é€šä¿¡ï¼Œå¦‚æœ9300æœªå¼€æ”¾å°†ä¸èƒ½ä½¿ç”¨é›†ç¾¤ã€‚
</code></pre>
<p>cURLæ˜¯ä¸€ä¸ªåˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼ˆå¯ä»¥è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹cURLçš„è¯­æ³•ï¼‰</p>
<p>Elasticsearché¢å‘æ–‡æ¡£(document oriented)<br>
å¯ä»¥å­˜å‚¨æ•´ä¸ªå¯¹è±¡æˆ–æ–‡æ¡£<br>
ç´¢å¼•(index) æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ä½¿ä¹‹å¯ä»¥è¢«æœç´¢<br>
ï¼ˆå®˜æ–¹é“¾æ¥ï¼‰  Elasticsearchå®˜æ–¹å®¢æˆ·ç«¯ ä¼šè‡ªåŠ¨ä¸ºä½ åºåˆ—åŒ–å’Œååºåˆ—åŒ–JSONã€‚<br>
åœ¨Elasticsearchä¸­å­˜å‚¨æ•°æ®çš„è¡Œä¸ºå°±å«åšç´¢å¼•(indexing)<br>
æ–‡æ¡£å½’å±äºä¸€ç§ç±»å‹(type) ï¼Œ è€Œè¿™äº›ç±»å‹å­˜åœ¨äºç´¢å¼•(index) ä¸­<br>
elasticsearchåˆ†ä¸ºåŠ¨æ€æ˜ å°„å’Œé™æ€æ˜ å°„ä¸¤ç§</p>
<p>å¸¸ç”¨ç±»å‹</p>
<ol>
<li>
<p>å­—ç¬¦ä¸²ç±»å‹<br>
textç±»å‹ï¼šç”Ÿæˆå€’æ’ç´¢å¼•ä¹‹å‰ï¼Œå­—ç¬¦ä¸²åˆ†è§£æˆä¸€ä¸ªä¸ªè¯é¡¹ï¼Œtextç±»å‹å­—æ®µä¸ç”¨äºæ’åºï¼Œå¾ˆå°‘ç”¨äºèšåˆã€‚<br>
keywordï¼šé€‚ç”¨äºç´¢å¼•ç»“æ„åŒ–çš„å­—æ®µï¼Œå¦‚æœå­—æ®µéœ€è¦è¿›è¡Œæ’åºã€è¿‡æ»¤ã€‚èšåˆç­‰æ“ä½œå¯ä»¥ä½¿ç”¨ï¼Œ keywordç±»å‹åªèƒ½é€šè¿‡ç²¾ç¡®æŸ¥æ‰¾ã€‚</p>
</li>
<li>
<p>dateç±»å‹<br>
æ—¥æœŸæ ¼å¼<br>
ï¼ˆ1ï¼‰æ—¥æœŸæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ â€œ2018-01-13â€ æˆ– â€œ2018-01-13 12:10:30â€<br>
ï¼ˆ2ï¼‰longç±»å‹çš„æ¯«ç§’æ•°( milliseconds-since-the-epochï¼Œepochå°±æ˜¯æŒ‡UNIXè¯ç”Ÿçš„UTC<br>
æ—¶é—´1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’)<br>
ï¼ˆ3ï¼‰integerçš„ç§’æ•°(seconds-since-the-epoch)</p>
</li>
<li>
<p>Arrayï¼ˆæ•°ç»„ï¼‰ç±»å‹<br>
1. elä¸­æ²¡æœ‰ä¸“é—¨çš„æ•°ç»„æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»æ„å­—æ®µéƒ½å¯ä»¥æœ‰0æˆ–nä¸ª å€¼ï¼Œæ‰€ä»¥æ„å‘³ç€æ¯ä¸ªå­—æ®µ           éƒ½æ˜¯æ•°ç»„ç±»å‹<br>
2.åœ¨elä¸­æ•°ç»„å¼€ç®±å³ç”¨ï¼Œä¸éœ€è¿›è¡Œé…ç½®ã€‚<br>
3.ä¸€ä¸ªæ•°ç»„å†…å…ƒç´ ç±»å‹æ˜¯ç›¸åŒçš„</p>
</li>
</ol>
<p>ä»¥åŠ  æ•´æ•°ç±»å‹ï¼Œæµ®ç‚¹ç±»å‹ï¼Œbinaryï¼ˆäºŒè¿›åˆ¶ï¼‰ç±»å‹ï¼Œbooleanç±»å‹</p>
<p>ikåˆ†è¯å™¨<br>
æœ‰ä¸¤ä¸ªåˆ†è¯ç®—æ³•<br>
1.ik_smart ä¸ºæœ€å°‘åˆ‡åˆ†<br>
2.ik_max_wordä¸ºæœ€ç»†ç²’åº¦åˆ’åˆ†</p>
<p>Kibana æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°</p>
<p>ç”»ä¸€äº›ç®€å•çš„å¯¹æ¯”å›¾æ¥ç±»æ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“<br>
ä¼ ç»Ÿæ•°æ®åº“ï¼šRelational DB -&gt; Databases -&gt; Tables -&gt; Rows -&gt; Columns<br>
Elasticsearchï¼šElasticsearch -&gt; Indices -&gt; Types -&gt; Documents -&gt; Fields<br>
PUT ï¼ˆæ“ä½œæ–¹å¼ï¼‰/megacorpï¼ˆç´¢å¼•ï¼‰/employeeï¼ˆç±»å‹ï¼‰/2ï¼ˆæ–‡æ¡£ï¼‰  {â€œfristâ€ï¼šâ€œnameâ€}ï¼ˆå­—æ®µï¼‰<br>
_searchæœç´¢æ‰€æœ‰æ–‡æ¡£</p>
<p>JavaResté«˜çº§å®¢æˆ·ç«¯<br>
ä¸‰ç§å®¢æˆ·ç«¯<br>
1. Transport Client<br>
2. Java Low Level Rest Clientï¼ˆä½çº§restå®¢æˆ·ç«¯ï¼‰<br>
3. Java High Level REST Clientï¼ˆé«˜çº§restå®¢æˆ·ç«¯ï¼‰</p>
<p>ä¸‰è€…çš„åŒºåˆ«<br>
1.TransportClientæ²¡æœ‰ä½¿ç”¨RESTfulé£æ ¼çš„æ¥å£ï¼Œè€Œæ˜¯äºŒè¿›åˆ¶çš„æ–¹å¼ä¼ è¾“æ•°æ®ã€‚<br>
2.ESå®˜æ–¹æ¨å‡ºäº†Java Low Level REST Client,å®ƒæ”¯æŒRESTfulã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯å› ä¸º<br>
TransportClientçš„ä½¿ç”¨è€…æŠŠä»£ç è¿ç§»åˆ°Low Level REST Clientçš„å·¥ä½œé‡æ¯”è¾ƒå¤§ã€‚<br>
3.ESå®˜æ–¹æ¨å‡ºJava High Level REST Client,å®ƒæ˜¯åŸºäºJava Low Level REST Clientçš„å°<br>
è£…ï¼Œå¹¶ä¸”APIæ¥æ”¶å‚æ•°å’Œè¿”å›å€¼å’ŒTransportClientæ˜¯ä¸€æ ·çš„ï¼Œä½¿å¾—ä»£ç è¿ç§»å˜å¾—å®¹æ˜“<br>
å¹¶ä¸”æ”¯æŒäº†RESTfulçš„é£æ ¼ï¼Œå…¼å®¹äº†è¿™ä¸¤ç§å®¢æˆ·ç«¯çš„ä¼˜ç‚¹ã€‚å¼ºçƒˆå»ºè®®ES5åŠå…¶ä»¥åçš„<br>
ç‰ˆæœ¬ä½¿ç”¨Java High Level REST Clientã€‚</p>
<p>ä¾èµ–åæ ‡<br>
<dependency><br>
<groupId>org.elasticsearch.client</groupId><br>
<artifactId>elasticsearchâ€restâ€highâ€levelâ€client</artifactId><br>
<version>ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚7.4.0ï¼‰</version><br>
</dependency></p>
<p>ElasticSearchæ“ä½œæµç¨‹ï¼š</p>
<pre><code>1.åˆ›å»ºç´¢å¼•åº“ï¼ˆç›¸å½“äºåˆ›å»ºæ•°æ®åº“ï¼‰ 
    PUT index_name 
2.åˆ›å»ºæ˜ å°„ï¼ˆç›¸å½“äºåˆ›å»ºè¡¨ç»“æ„ï¼‰
    PUT index_name/mapping
    æ¨èï¼šï¼ˆé™æ€æ˜ å°„ï¼‰
    ä¸ä½¿ç”¨åŠ¨æ€æ˜ å°„çš„åŸå› ï¼šåŸŸä¸å¯æ§ï¼Œâ€œç±»å‹â€ã€â€œæ˜¯å¦ç´¢å¼•â€ã€â€œæ˜¯å¦å­˜å‚¨â€ã€â€œå¯¼å…¥ç´¢å¼•åº“åˆ†è¯å™¨â€ã€â€œæœç´¢åˆ†è¯â€ä½¿ç”¨çš„éƒ½æ˜¯é»˜è®¤å€¼ï¼Œæœ‰æ—¶å€™é»˜è®¤å€¼ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„
     {
        &quot;properties&quot;:{
             &quot;name&quot;:{
                type:&quot;&quot;,//æŒ‡å®šæ•°æ®ç±»å‹
                index:&quot;&quot;,//æ˜¯å¦ç´¢å¼•
                store:&quot;&quot;,//æ˜¯å¦å­˜å‚¨
               analyzer:&quot;&quot;,//åˆ›å»ºç´¢å¼•ä½¿ç”¨çš„åˆ†è¯å™¨
                analyzer_search:&quot;&quot;//æœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨
                }
           }    
         }

   3.æ·»åŠ æ–‡æ¡£(æ¨èä»¥æ•°æ®ID&lt;ä¸»é”®&gt;ä½œä¸ºæ–‡æ¡£å”¯ä¸€æ ‡è¯†ï¼Œè€Œä¸ä½¿ç”¨ESè‡ªåŠ¨ç”Ÿæˆçš„                IDï¼šé¿å…é‡å¤æ•°æ®é—®é¢˜)
    æ•°æ®ç»´æŠ¤ï¼ˆå…¨é‡ç´¢å¼•ã€å¢é‡ç´¢å¼•ã€å®šæ—¶ç´¢å¼•ã€ç´¢å¼•åŒæ­¥ï¼‰
        PUT index_name/doc/{id} 
            {
                &quot;name&quot;:&quot;&quot;,
                &quot;age&quot;:&quot;&quot;
            }

  4.æœç´¢/æŸ¥è¯¢æ–‡æ¡£ 
    ESæ”¯æŒçš„æŸ¥è¯¢æ–¹å¼ï¼šmatchAllï¼ˆæŸ¥è¯¢å…¨éƒ¨ï¼‰ã€termï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ã€matchï¼ˆåˆ†è¯æŸ¥è¯¢ï¼‰ã€boolï¼ˆå¤šæ¡ä»¶æ‹¼æ¥ï¼‰ã€queryStringï¼ˆå¤šåŸŸæŸ¥è¯¢ï¼‰ã€highlightï¼ˆé«˜äº®ï¼‰ã€åˆ†é¡µã€rangeï¼ˆèŒƒå›´ï¼‰ã€sortï¼ˆæ’åºï¼‰ã€            aggregationï¼ˆåˆ†ç»„èšåˆï¼‰ã€ï¼ˆæ¨¡ç³Šï¼Œæ­£åˆ™ï¼Œå‰åç¼€ï¼‰
        GET index_name/search
        GET index_name/doc/{id}
</code></pre>
<p>bulk:<br>
æ‰¹å¤„ç†å‡å°‘è¯·æ±‚æ¬¡æ•°ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ï¼ˆå®é™…å¼€å‘ä¸­ä¸€èˆ¬æ˜¯æ‰¹é‡åšæŸä¸€é¡¹å¤„ç†BulkRequestï¼‰</p>
<p>ES JavaAPIæœç´¢æ“ä½œæµç¨‹:<br>
1.è¿æ¥ESç´¢å¼•åº“ã€è·å–ESé«˜çº§å®¢æˆ·ç«¯å¯¹è±¡RestHighLevelClient(ä¸åŒçš„ESç‰ˆæœ¬è·å–æ–¹å¼ä¼šæœ‰ç»†å¾®çš„å·®å¼‚)<br>
ES7.xç‰ˆæœ¬è·å–RestHighLevelClientå¯¹è±¡æ–¹å¼<br>
åˆ›å»ºé«˜çº§å®¢æˆ·ç«¯ï¼ˆES7ç‰ˆæœ¬åŠä»¥ä¸Šï¼‰<br>
new RestHighLevelClient(RestClient.builder(<br>
new HttpHost(<br>
host,<br>
port,<br>
&quot;http&quot;<br>
)<br>
application.xmlè¿›è¡Œé…ç½®<br>
elasticsearch:<br>
host: 192.168.149.135<br>
port: 9200<br>
2.åˆ›å»ºæŸ¥è¯¢å¯¹è±¡SearchRequestã€SearchSourceBuildã€BoolQueryBuild<br>
ES7.xç‰ˆæœ¬ä¸­SearchRequeståªéœ€è¦æŒ‡å®šâ€œç´¢å¼•åº“åç§°â€å³å¯ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„ç±»å‹ï¼›å¦‚æœæ˜¯7.xä»¥ä¸‹ç‰ˆæœ¬è¿˜éœ€è¦æŒ‡å®šâ€œtypeç±»å‹â€</p>
<p>//æ„å»ºæŸ¥è¯¢è¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡å®šæŸ¥è¯¢çš„ç´¢å¼•åç§°<br>
SearchRequest searchRequest = new SearchRequest(&quot;goods&quot;);<br>
//åˆ›å»ºæŸ¥è¯¢æ¡ä»¶æ„å»ºå™¨<br>
SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();<br>
//æ„å»ºå¤šæ¡ä»¶æ‹¼æ¥æ„é€ å™¨<br>
BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();<br>
3.æ ¹æ®ä¼ é€’çš„â€œæœç´¢æ¡ä»¶â€å°è£…è¯·æ±‚å¯¹è±¡<br>
boolQueryBuilderï¼štermã€matchã€rangeã€queryStringã€filter</p>
<p>//2.æ„å»ºå„ä¸ªæŸ¥è¯¢æ¡ä»¶<br>
//2.1 æŸ¥è¯¢å“ç‰Œåç§°ä¸º:åä¸º<br>
QueryBuilder termQuery = QueryBuilders.termQuery(&quot;brandName&quot;,&quot;åä¸º&quot;);<br>
boolQueryBuilder.must(termQuery);<br>
//2.2. æŸ¥è¯¢æ ‡é¢˜åŒ…å«ï¼šæ‰‹æœº<br>
QueryBuilder matchQuery = QueryBuilders.matchQuery(&quot;title&quot;,&quot;æ‰‹æœº&quot;);<br>
boolQueryBuilder.filter(matchQuery);<br>
//2.3 æŸ¥è¯¢ä»·æ ¼åœ¨ï¼š2000-3000<br>
QueryBuilder rangeQuery = QueryBuilders.rangeQuery(&quot;price&quot;);<br>
((RangeQueryBuilder) rangeQuery).gte(2000);<br>
((RangeQueryBuilder) rangeQuery).lte(3000);<br>
boolQueryBuilder.filter(rangeQuery);<br>
è¿‡æ»¤æŸ¥è¯¢çš„ä¼˜ç‚¹ï¼šä¸è®¡ç®—å¾—åˆ†ã€æ•ˆç‡é«˜<br>
searchSourceBuilderï¼šåˆ†é¡µã€æ’åºã€åˆ†ç»„èšåˆã€é«˜äº®</p>
<p>//åˆ†é¡µ<br>
searchSourceBuilder.from(0);<br>
searchSourceBuilder.size(100);<br>
//æ’åº<br>
searchSourceBuilder.sort(&quot;price&quot;, SortOrder.DESC);<br>
//åˆ†ç»„èšåˆ<br>
AggregationBuilder agg = AggregationBuilders.terms(&quot;goods_brands&quot;).field(&quot;brandName&quot;).size(100);<br>
searchSourceBuilder.aggregation(agg);<br>
//é«˜äº®<br>
HighlightBuilder highlighter = new HighlightBuilder();<br>
highlighter.field(&quot;title&quot;);<br>
highlighter.preTags(&quot;<font color='red'>&quot;);<br>
highlighter.postTags(&quot;</font>&quot;);<br>
searchSourceBuilder.highlighter(highlighter);<br>
æ ¹æ®è¯·æ±‚å¯¹è±¡å±‚æ¬¡ç»“æ„è¿›è¡Œè¯·æ±‚å¯¹è±¡çš„åˆå¹¶</p>
<p>//boolQueryBuilderæ”¾å…¥searchSourceBulider<br>
searchSourceBulider.query(boolQueryBuilder);<br>
//searchSourceBulideræ”¾å…¥searchRequest<br>
searchRequest.source(searchSourceBulider);</p>
<pre><code>------------------------------------------------ -------------------------------------------------- -------------------------------------------
boolQueryBuilderæ”¾å…¥SearchSourceBuilderä¸­ï¼›SearchSourceBuilderæ”¾å…¥ searchRequestï¼›æœ€ç»ˆæ‰€æœ‰æŸ¥è¯¢æ¡ä»¶éƒ½åœ¨searchRequest
-------------------------------------------------------- -------------------------------------------------- -------------------------------------------
</code></pre>
<p>4.ä½¿ç”¨RestHighLevelClientæ‰§è¡ŒæŸ¥è¯¢</p>
<p>//æ‰§è¡ŒæŸ¥è¯¢<br>
SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);</p>
<p>é›†ç¾¤&amp;åˆ†å¸ƒå¼<br>
é›†ç¾¤<br>
æ¦‚å¿µ:æŠŠä¸€ä¸ªåŠŸèƒ½æ¨¡å—ä»£ç éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ï¼Œå®ƒä»¬å®Œæˆç›¸åŒçš„å·¥ä½œ<br>
ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ã€é«˜å¹¶å‘ã€é«˜æ€§èƒ½</p>
<pre><code>è´Ÿè½½å‡è¡¡
    æ¦‚å¿µï¼šæ ¹æ®æœåŠ¡å™¨æ€§èƒ½ä¸åŒï¼Œåˆ†é…å¯¹åº”çš„è´Ÿè½½ï¼ˆè¯·æ±‚æ•°ï¼‰

åˆ†å¸ƒå¼ï¼š
    æ¦‚å¿µï¼šæŠŠä¸€ä¸ªé¡¹ç›®æ‹†åˆ†æˆå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œåä½œå®ŒæˆåŒä¸€ä¸ªæµç¨‹
    ä¼˜ç‚¹ï¼šé«˜å¹¶å‘ã€é«˜æ‰©å±•ã€è§£è€¦
</code></pre>
<p>ESé›†ç¾¤ç›¸å…³æ¦‚å¿µï¼š<br>
é›†ç¾¤ï¼šæ‹¥æœ‰ç›¸åŒcluster-nameçš„èŠ‚ç‚¹ï¼Œæ‰€æ„æˆçš„æ•´ä½“<br>
èŠ‚ç‚¹ï¼šæ¯ä¸ªelastic-searchå®ä¾‹<br>
ç´¢å¼•ï¼šeså­˜å‚¨æ•°æ®çš„åœ°æ–¹<br>
åˆ†ç‰‡ï¼šç´¢å¼•å¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†è¿›è¡Œå­˜å‚¨ï¼Œç§°ä¸ºåˆ†ç‰‡ ï¼ˆä¸»åˆ†ç‰‡ã€å‰¯åˆ†ç‰‡ï¼‰</p>
<p>ESé›†ç¾¤æ­å»ºï¼š<br>
æ³¨æ„ï¼šè‡³å°‘ä¸‰å°æœåŠ¡å™¨æˆ–è€…ä¸‰ä¸ªMasterå®ä¾‹ï¼Œ<br>
linuxæœåŠ¡å™¨æ­å»ºçš„ç›¸åº”æ­¥éª¤æƒ³è¦çš„åŒå­¦å¯ä»¥ç•™è¨€ã€‚<br>
ğŸ˜ƒğŸ˜ƒ<br>
ESé›†ç¾¤è„‘è£‚é—®é¢˜ï¼š<br>
è„‘è£‚ï¼šé›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹èµ„æºç«äº‰éƒ½æƒ³ç§°ä¸ºä¸»èŠ‚ç‚¹<br>
äº§ç”ŸåŸå› ï¼šç½‘ç»œå»¶æ—¶ã€å†…å­˜å›æ”¶ã€è´Ÿè½½å¤ªå¤§<br>
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å†…ç½‘è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®é•¿ä¸€ç‚¹ã€jvmå†…å­˜è®¾ç½®å¤§ä¸€ç‚¹ã€ä¸»èŠ‚ç‚¹åªè´Ÿè´£ç®¡ç†ä»èŠ‚ç‚¹åªå­˜å‚¨æ•°æ®</p>
<p>ESé›†ç¾¤é»˜è®¤è®¾ç½®ï¼š<br>
åˆå§‹åŒ–ï¼šåˆ†5ç‰‡ã€æ¯ä¸ªåˆ†ç‰‡1ä¸ªå¤‡ä»½ï¼Œå…±10ç‰‡ï¼ˆä½¿ç”¨ES-headï¼Œåˆ›å»ºç´¢å¼•åº“çš„æ¨èè®¾ç½®ï¼‰<br>
æ–°å¢ç´¢å¼•åº“ï¼šåˆ†1ç‰‡ã€æ¯ä¸ªåˆ†ç‰‡1ä¸ªå¤‡ä»½</p>
<p>ESé›†ç¾¤æ¨èè®¾ç½®ï¼ˆæœ€å¤šé™åº¦å……åˆ†åˆ©ç”¨èµ„æºï¼‰ï¼š<br>
1.æ¯ä¸ªåˆ†ç‰‡æ¨èå¤§å°10-30GB<br>
2.åˆ†ç‰‡æ•°é‡æ¨è = èŠ‚ç‚¹æ•°é‡ * 1~3å€</p>
<p>ESé›†ç¾¤è·¯ç”±ï¼š<br>
shard_index = hash(id)%ä¸»åˆ†ç‰‡æ•°é‡</p>
<p>Kibanaç®¡ç†é›†ç¾¤</p>
<p>åªéœ€è¦ä¿®æ”¹kibanaé…ç½®æ–‡ä»¶config/kibana.yml<br>
#æ‰€æœ‰èŠ‚ç‚¹çš„ipã€ç«¯å£éƒ½å†™åœ¨ä¸­æ‹¬å·å³å¯<br>
elasticsearch.hosts: [&quot;http://localhost:9201&quot;,&quot;http://localhost:9202&quot;]JavaAPIæ“ä½œESé›†ç¾¤<br>
åªéœ€è¦è·å–RestHighLevelClientå¯¹è±¡ï¼Œä½¿ç”¨é›†ç¾¤æ–¹å¼ï¼š</p>
<p>//é›†ç¾¤æ–¹å¼è·å–RestHighLevelClient<br>
new RestHighLevelClient(RestClient.builder(<br>
new HttpHost(host,port,schema),new HttpHost(host,port,schema)...<br>
))</p>

              </div>
              <div class="toc-container">
                
              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://fubaiwudu.github.io/post/wangyang/">
              <h3 class="post-title">
                ç‹æ´‹å–œæ¬¢çš„äººï¼Œæ–¯å·´æ‹‰è¥¿
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://fubaiwudu.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
